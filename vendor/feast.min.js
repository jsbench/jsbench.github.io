/*
 * Copyright (c) 2015, Joel Richard
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/.
 */

/**
 * @author RubaXa <trash@rubaxa.org>
 * @license MIT
 */

(function(e){e("src/xmlparser",[],function(){"use strict";function S(e,t){return new x(e,t)}function x(e,n){this.uid=++t,this.name=e||"#",this.shorty=w[e]!==void 0,this.value="",this.attrs=n||{},this.length=0,this.children=[]}var e=function(e){return e.charCodeAt(0)},t=0,n=/^\s+$/,r=e("\n"),i=e("<"),s=e(">"),o=e("="),u=e("!"),a=e("a"),f=e("z"),l=e("0"),c=e("9"),h=e("-"),p=e(":"),d=e('"'),v=e("/"),m=e("\\"),g=33,y=1,b=2,w={area:1,base:1,br:1,col:1,command:1,embed:1,hr:1,img:1,input:1,keygen:1,link:1,meta:1,param:1,source:1,wbr:1,space:1,enter:1},E=function(t,m,w){function F(e){var t=w[e.name],n;t!==void 0&&(n=typeof t=="string"?t:t(e,e.attrs),typeof n=="string"&&e.replace(n))}function I(e){var t=w["#text"],n,r=e.value;if(t!==void 0){n=t(r,e);if(n!==r){var i=m.line;m.line=L-1,n=E(n,m,w),m.line=i,e.replace(n.children)}}}function q(e){var n=t.indexOf("\n",x),r=x-O+1;n<=0&&(n=t.length);var i=A+":"+L+":"+r+"\n"+e+"\n"+t.substring(O,n).replace(/\t/g," ")+"\n"+(new Array(r)).join("-")+"^",s=new SyntaxError(i);throw s.file=A,s.line=L,s.column=r,s}function R(){var e=t.charCodeAt(++x);e!==d&&q('"'+B+'" expected value of the attribute in quotes'),T=++x;while(x<N){C=t.charCodeAt(x);if(e===C)return t.substring(T,x);x++}x-=(x-T)/2+1|0,q('Unclosed string literal in "'+B+'" attribute')}w=w||{},m=m||{};var x=0,T=0,N=t.length,C,k=S("#root"),L=m.line||1,A=m.file,O=0,M,_=0,D,P,H,B,j;while(x<N)C=t.charCodeAt(x),C<g&&C===r&&(O=x+1,L++),P===y?C===s||C===v&&t.charCodeAt(++x)===s?(H=t.substring(M,_+1),P=void 0,_=x+1,k.name==="#"?(k.name=H,C===v&&(k.shorty=!0,F(k),k=k.parent)):k.name===H?(F(k),k=k.parent):q('Wrong close "'+H+'" tag should be "'+k.name+'"')):C<g?(T=x,P=b,D=void 0):C>=a&&C<=f||C>=l&&C<=c||C===h||C===p?_=x:C===u?(t.charAt(x+1)==="-"?(k.name="#comment",k.value=t.substr(x).match(/--([\s\S]*?)-->/)[1],x+=k.value.length+5,k=k.parent):(k.name="#cdata",k.value=t.substr(x).match(/\[CDATA\[([\s\S]*?)\]\]>/)[1],x+=k.value.length+10,k=k.parent),P=_=void 0,T=x):q("Invalid character in node name"):P===b?C===v||C===s?(D!==void 0&&k.attr(t.substring(D,x).trim(),!0),x--,P=y):C===o||C<g?D!==void 0&&(B=t.substring(D,x).trim(),k.attr(B,C<g?!0:R()),D=void 0):(C<a||C>f)&&C!==h&&C!==p?q("Invalid character in attrbiute name"):D===void 0&&(D=x):C===i&&(x-_>0&&(j=t.substring(_,x),n.test(j)===!1&&(k.appendText(j),I(k.last))),t.charCodeAt(x+1)===v?x++:(k=k.newChild(),k.file=A,k.line=L),M=x+1,P=y),x++;return P===y?q('"'+t.substring(M,x)+'" tag should be closed'):k.name!=="#root"&&q('"'+k.name+'" tag should be closed'),x-_>0&&(j=t.substring(_,x),n.test(j)===!1&&(k.appendText(j),I(k.last))),k};return x.prototype={create:S,attr:function(e,t){return this.attrs[e]=t,this},closest:function(e){var t=this;if(t.name!==e)while((t=t.parent)&&t.name!==e);return t},index:function(){return this.parent?this.parent.children.indexOf(this):-1},append:function(e,t){var n=this.children;return t===void 0?n.push(e):n.splice(t.index(),0,e),this.first=n[0],this.last=n[(this.length=n.length)-1],e.parent=this,this},empty:function(){return this.length=0,this.children=[],delete this.first,delete this.last,this},remove:function(){var e=this.parent;if(e){var t=e.children;t.splice(this.index(),1),e.length--,e.first=t[0],e.last=t[e.length-1]}return this},wrap:function(e,t){var n=S(e,t);return n.file=this.file,n.line=this.line,this.parent.append(n,this),n.append(this.remove()),n},innerWrap:function(e,t){var n=S(e,t),r=this.children,i=0,s=r.length;this.children=[];for(;i<s;i++)n.append(r[i]);return this.append(n)},replace:function(e){var t=this.parent,n=[].concat(e),r=0,i=n.length;this.remove();for(;r<i;r++)e=n[r],typeof e=="string"?t.appendText(e):t.append(e);return this},appendText:function(e){if(e!==""&&e!=null){var t=this.last;t===void 0||t.name!=="#text"?this.newChild("#text").value=e:t.value+=e}return this},newChild:function(e,t,n){var r=S(e,t);return r.file=this.file,r.line=this.line,this.append(r,n),r},exception:function(e){var t=new Error("<"+this.name+"/>: "+e+"\n"+this.file+" at line "+this.line);throw t.file=this.file,t.line=this.line,t},clone:function(){var e=S(this.name);for(var t in this.attrs)e.attrs[t]=this.attrs[t];for(var n=0;n<this.length;n++)e.append(this.children[n].clone());return e.file=this.file,e.line=this.line,e.value=this.value,e},toString:function(e,t){t=e&&t||"",e=e?"\n":"";var n=t+this.value,r=!this.parent;for(var i=0;i<this.length;i++)n+=this.children[i].toString(e,r?t:"  "+t);if(this.name.charAt(0)!="#"){var s="<"+this.name,o=[],u,a;for(u in this.attrs)a=this.attrs[u],a===!0?o.push(u):o.push(u+'="'+a+'"');o.length&&(s+=" "+o.join(" ")),n=e+t+s+(this.shorty&&!this.length?"/>":">"+n+e+t+"</"+this.name+">")}return r?n.trim():n}},E.newNode=S,E}),function(t){e("citojs",[],function(){return typeof window=="undefined"?{vdom:{}}:t(window)})}(function(e,t){"use strict";function m(e){return typeof e=="string"}function g(e){return e instanceof Array}function y(e){return typeof e=="function"}function b(e,n){var r=typeof e;return r==="string"?e={tag:"#",children:e}:r==="function"&&(e=e(n),e=e===t?n:b(e,n)),e}function w(e,t,n){var r=b(t,n);return t!==r&&e&&(e.children=r),r}function E(e,t,n){var r=w(null,T(e,t));return r.dom||(r.dom=n.firstChild,r.tag==="<"&&(r.domLength=n.childNodes.length)),r}function S(e,t,n){var r=e[t],i=b(r,n);return r!==i&&(e[t]=i),i}function x(e,n,r){return y(n)&&(n=n(r),n===t&&(n=r),e.children=n),n}function T(e,t){return t===1?e[0]:e}function N(e,t,n){var r=t.dom,i=t.domLength||1,s,o=n&&n.dom;if(r!==o)while(i--)s=i>0?r.nextSibling:null,o?e.insertBefore(r,o):e.appendChild(r),r=s}function C(){return r.createTextNode("")}function O(e,t,n){if(e.insertAdjacentHTML){var r,i,s;if(L||A){var o=t==="beforebegin"?e.previousSibling:t==="beforeend"?e.lastChild:null;o&&o.nodeType===3&&(r=o,A&&o.length===0&&(s=!0,o.nodeValue=" "),L&&(i=o.length))}e.insertAdjacentHTML(t,n),r&&(L&&r.length!==i&&r.splitText(i),A&&s&&(r.nodeValue=""))}else{c.innerHTML=n;if(t==="beforebegin"){var u=e.parentNode;while(c.firstChild)u.insertBefore(c.firstChild,e)}else if(t==="beforeend")while(c.firstChild)e.appendChild(c.firstChild)}}function M(e,t,n,r){if(n){var i=n.dom;if(r){var s=n.domLength||1;s===1?(dt(n),e.replaceChild(t,i)):(e.insertBefore(t,i),tt(e,n))}else e.insertBefore(t,i)}else e.appendChild(t)}function _(e,n,i,s,o,u){if(l)return P(e,n,s,o);var a,f=e.tag,c=e.children;switch(f){case t:return U(e,c,n,i,s,o);case"#":if(u){nt(n,c);return}a=r.createTextNode(c);break;case"!":a=r.createComment(c);break;case"<":if(c){if(u)n.innerHTML=c;else{var h=n.childNodes,p=h.length;if(s){var d=s.dom,v=d.previousSibling;O(d,"beforebegin",c),a=v?v.nextSibling:n.firstChild}else O(n,"beforeend",c),a=h[p];e.dom=a,e.domLength=h.length-p,o&&s&&tt(n,s)}return}a=C();break;default:var m;switch(f){case"svg":m="http://www.w3.org/2000/svg";break;case"math":m="http://www.w3.org/1998/Math/MathML";break;default:m=i}var g=e.attrs,y=g&&g.is;m?(e.ns=m,a=y?r.createElementNS(m,f,y):r.createElementNS(m,f)):a=y?r.createElement(f,y):r.createElement(f),e.dom=a,l&&n&&M(n,a,s,o),typeof c=="string"?nt(a,c,!1):Q(a,e,m,c,!1),g&&z(a,f,m,g);var b=e.events;b&&V(a,e,b),!l&&n&&M(n,a,s,o);var w=b&&b.$created;w&&D(w,"$created",a,e);return}e.dom=a,n&&M(n,a,s,o)}function D(e,t,n,r,i,s){var o={type:t,target:n,virtualNode:r};i&&(o[i]=s);if(g(e)){for(var u=0;u<e.length;u++)if(e[u].call(n,o)===!1)return}else e.call(n,o)}function P(e,t,n,r){var i=B(e),s;if(t){var o;!n&&!t.hasChildNodes()?(t.innerHTML=i,s=t.firstChild):(n?(o=n.dom.previousSibling,O(n.dom,"beforebegin",i),r&&tt(t,n)):(o=t.lastChild,O(t,"beforeend",i)),s=o?o.nextSibling:t.firstChild)}else c.innerHTML=i,s=c.removeChild(c.firstChild);j(s,e)}function B(e,n){var r=e.tag,i=e.children;switch(r){case"#":return I(i)+H;case"!":return"<!--"+q(i)+"-->";case"<":return i+H;default:var s;if(r){var o=e.attrs;if(r==="select"&&o)n={selectedIndex:o.selectedIndex,value:o.value,optionIndex:0};else if(r==="option"&&n){if(n.value&&n.value===o.value||n.selectedIndex!==t&&n.selectedIndex===n.optionIndex)o.selected=!0;n.optionIndex++}s="<"+r;if(o){s+=" ";for(var u in o){var a=o[u];if(a===!1||r==="select"&&(u==="value"||u==="selectedIndex"))continue;if(r==="textarea"&&u==="value"){i=a;continue}if(a===!0)a="";else if(u==="style"&&!m(a)){var f="";for(var l in a)f+=l+": "+a[l]+"; ";a=f}s+=" "+R(u,a)}}}else s="";r&&(s+=">"),i=x(e,i);var c=G(i);if(c>1)for(var h=0,p=i.length;h<p;h++)s+=B(S(i,h),n);else if(c!==0){var d=T(i,c);if(m(d)){s+=I(d);if(!r||!d)s+=H}else s+=B(w(e,d),n)}else r||(s+=H);return r&&(s+="</"+r+">"),s}}function j(e,t){var n=t.tag;if(n){t.dom=e;var r,i;switch(n){case"#":r=e.nodeValue,i=r.indexOf(H),i!==-1&&(i+1<r.length&&e.splitText(i+1),e.nodeValue=r.substr(0,i));break;case"!":break;case"<":var s=0,o;for(;e;e=e.nextSibling){s++;if(e.nodeType===3){r=e.nodeValue;if(s>1&&r===H){o=e.nextSibling,e.parentNode.removeChild(e),s--;break}i=r.indexOf(H);if(i!==-1){i+1<r.length&&e.splitText(i+1),e.nodeValue=r.substr(0,i),o=e.nextSibling;break}}}return t.domLength=s,o;default:var u=t.children,a=G(u);if(a>1){u=t.children;var f=e.firstChild;for(var l=0,c=u.length;l<c;l++)f=j(f,u[l])}else if(a!==0){var h=T(u,a);m(h)?h||(e.firstChild.nodeValue=""):j(e.firstChild,h)}var p=t.events;if(p){V(e,t,p);var d=p.$created;d&&D(d,"$created",e,t)}}return e.nextSibling}return F(e,t)}function F(e,t){var n=t.children,r=G(n),i;if(r===0)e.length>1&&e.splitText(1),e.nodeValue="",t.dom=e,i=e.nextSibling;else{if(r>1){i=e;for(var s=0;s<n.length;s++)i=j(i,n[s]);e=n[0].dom}else{var o=w(t,T(n,r));i=j(e,o),e=o.dom}t.dom=e;var u=0;while(e!==i)u++,e=e.nextSibling;t.domLength=u}return i}function I(e){return e=""+e,a?(c.innerText=e,e=c.innerHTML):f?e=e.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;"):e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),e}function q(e){return e=""+e,e.replace(/-{2,}/g,"-")}function R(e,t){var n=typeof t;return t=""+t,n!=="number"&&(f?t=t.split("&").join("&amp;").split('"').join("&quot;"):t=t.replace(/&/g,"&amp;").replace(/"/g,"&quot;")),e+'="'+t+'"'}function U(e,t,n,r,i,s){t=x(e,t);var o=G(t),u,a,f;r&&(e.ns=r);if(o===0)u=C(),M(n,u,i,s);else if(o>1){a=0;for(var l=0,c=t.length;l<c;l++)f=S(t,l),_(f,n,r,i,!1),a+=f.domLength||1;u=t[0].dom,s&&tt(n,i)}else f=w(e,T(t,o)),_(f,n,r,i,s),u=f.dom,a=f.domLength;e.dom=u,e.domLength=a}function z(e,n,r,i,s,o){var u,a;if(i)for(a in i){var f=!1,l=i[a];if(a==="style"){var c=s&&s[a];c!==l&&(f=X(e,c,i,l))}else if($(n,a))e[a]!==l&&(e[a]=l,f=!0);else if(!s||s[a]!==l)a==="class"&&!r?e.className=l:W(e,a,l),f=!0;f&&o&&(u||(u=[])).push(a)}if(s)for(a in s)if(!i||i[a]===t)a==="class"&&!r?e.className="":$(n,a)||e.removeAttribute(a),o&&(u||(u=[])).push(a);return u}function W(e,t,n){if(n===!1)e.removeAttribute(t);else{n===!0&&(n="");var r=t.indexOf(":"),i;if(r!==-1){var s=t.substr(0,r);switch(s){case"xlink":i="http://www.w3.org/1999/xlink"}}i?e.setAttributeNS(i,t,n):e.setAttribute(t,n)}}function X(e,n,r,i){var s=!1,o;if(!m(i)&&(!v||!n||m(n))){var u="";if(i)for(o in i)u+=o+": "+i[o]+"; ";i=u,v||(r.style=i)}var a=e.style;if(m(i))a.cssText=i,s=!0;else{if(i)for(o in i){var f=i[o];if(!n||n[o]!==f){var l=f.indexOf("!important");if(l!==-1)a.setProperty(o,f.substr(0,l),"important");else{if(n){var c=n[o];c&&c.indexOf("!important")!==-1&&a.removeProperty(o)}a.setProperty(o,f,"")}s=!0}}if(n)for(o in n)if(!i||i[o]===t)a.removeProperty(o),s=!0}return s}function V(e,t,n,r){var i;if(n){e.virtualNode=t;for(i in n)(!r||!r[i])&&J(e,i)}if(r)for(i in r)(!n||!n[i])&&K(e,i)}function $(e,t){switch(e){case"input":return t==="value"||t==="checked";case"textarea":return t==="value";case"select":return t==="value"||t==="selectedIndex";case"option":return t==="selected"}}function J(e,t){if(t[0]!=="$")if(p)e.addEventListener(t,st,!1);else{var n="on"+t;n in e?e[n]=st:e.attachEvent(n,st)}}function K(e,t){if(t[0]!=="$")if(p)e.removeEventListener(t,st,!1);else{var n="on"+t;n in e?e[n]=null:e.detachEvent(n,st)}}function Q(e,t,n,r,i){r=x(t,r);var s=G(r);if(s>1)for(var o=0,u=r.length;o<u;o++)_(S(r,o),e,n);else if(s!==0){var a=T(r,s);!i&&m(a)?nt(e,a):(a=w(t,a),_(a,e,n,null,!1,!i))}}function G(e){return g(e)?e.length:e||m(e)?-1:0}function Z(e,t,n){n>1?et(e,t,0,t.length):n!==0&&(m(t)?e.removeChild(e.firstChild):tt(e,E(t,n,e)))}function et(e,t,n,r){for(;n<r;n++)tt(e,t[n])}function tt(e,t){dt(t);var n=t.dom,r=t.domLength||1,i;while(r--)i=r>0?n.nextSibling:null,e.removeChild(n),n=i}function nt(e,t,n){if(t)h?e.textContent=t:e.innerText=t;else{if(n)while(e.firstChild)e.removeChild(e.firstChild);e.appendChild(C())}}function rt(e,t,n,r,i,s,o){i=x(t,i,r);if(i===r)return;var u=G(r);if(u===0){Q(e,t,n,i,!1);return}var a=G(i),f,l;if(a===0){Z(e,r,u);return}if(a<2){l=T(i,a);if(!s&&m(l)){if(a===u){f=T(r,u);if(l===f)return;if(m(f)){e.firstChild.nodeValue=l;return}}vt(r,u),nt(e,l,!0);return}if(u<2){f=E(r,u,e),l=w(t,l,f),ht(f,l,e,n,null,0,o,!s);return}}a===-1&&(t.children=i=[i]),u<2&&(f=E(r,u,e),u===1?r[0]=f:r=[f]);var c=r.length,h=i.length,p=c-1,d=i.length-1,v=0,g=0,y=!0,b;e:while(y&&v<=p&&g<=d){y=!1;var C,k,L,A;C=r[v],L=S(i,g,C);while(C.key===L.key){ht(C,L,e,n,r,v+1,o),v++,g++;if(v>p||g>d)break e;C=r[v],L=S(i,g,C),y=!0}k=r[p],A=S(i,d);while(k.key===A.key){ht(k,A,e,n,i,d+1,o),p--,d--;if(v>p||g>d)break e;k=r[p],A=S(i,d),y=!0}while(C.key===A.key){b=d+1<h?i[d+1]:o,ht(C,A,e,n,null,0,b),N(e,A,b),v++,d--;if(v>p||g>d)break e;C=r[v],A=S(i,d),y=!0}while(k.key===L.key){b=v<c?r[v]:o,ht(k,L,e,n,null,0,b),N(e,L,b),p--,g++;if(v>p||g>d)break e;k=r[p],L=S(i,g),y=!0}}if(v>p){b=d+1<h?S(i,d+1):o;for(O=g;O<=d;O++)_(S(i,O),e,n,b)}else if(g>d)et(e,r,v,p+1);else{var O,M=r[p+1],D={};for(O=p;O>=v;O--)f=r[O],f.next=M,D[f.key]=f,M=f;b=d+1<h?S(i,d+1):o;for(O=d;O>=g;O--){l=i[O];var P=l.key;f=D[P],f?(D[P]=null,M=f.next,ht(f,l,e,n,null,0,b),(M&&M.key)!==(b&&b.key)&&N(e,l,b)):_(l,e,n,b),b=l}for(O=v;O<=p;O++)f=r[O],D[f.key]!==null&&tt(e,f)}}function st(e){e=lt(e,this);var t=e.currentTarget,n=t.virtualNode.events[e.type];if(g(n))for(var r=0,i=n.length;r<i;r++){ct(n[r],t,e);if(it){it=!1;break}}else ct(n,t,e)}function ot(){return this.defaultPrevented}function ut(){this.defaultPrevented=!0,this.returnValue=!1}function at(){this.cancelBubble=!0}function ft(){it=!0,this.stopPropagation()}function lt(t,n){return t||(t=e.event,t.preventDefault||(t.preventDefault=ut,t.stopPropagation=at,t.defaultPrevented=t.returnValue===!1,t.target=t.srcElement),t.currentTarget=n.nodeType?n:t.target),t.isDefaultPrevented||(t.isDefaultPrevented=ot),t.stopImmediatePropagation=ft,t}function ct(e,t,n){try{e.call(t,n)===!1&&n.preventDefault()}catch(r){o.error(r.stack||r)}}function ht(e,n,r,i,s,o,u,a){if(n===e)return;var f=n.tag;if(e.tag!==f)_(n,r,i,e,!0);else{var l=e.dom,c=e.children,h=n.children;switch(f){case t:var p=s&&o<s.length?s[o]:u;pt(e,c,n,h,r,i,p);break;case"#":case"!":c!==h&&(l.nodeValue=h),n.dom=l;break;case"<":c!==h?_(n,r,null,e,!0,a):(n.dom=e.dom,n.domLength=e.domLength);break;default:var d=n.attrs,v=e.attrs;if((d&&d.is)!==(v&&v.is)){_(n,r,i,e,!0);return}var m=e.ns;m&&(n.ns=m),n.dom=l,h!==c&&rt(l,n,m,c,h,!1);var g=n.events,y=e.events;if(d!==v){var b=g&&g.$changed,w=z(l,f,m,d,v,!!b);w&&D(b,"$changed",l,n,"changes",w)}g!==y&&V(l,n,g,y),g!==void 0&&g.$subtreeModified!==void 0&&D(g.$subtreeModified,"$subtreeModified",l,n)}}}function pt(e,t,n,r,i,s,o){r=x(n,r,t);if(r===t)return;var u=G(r),a=G(t),f,l;s&&(n.ns=s);if(u===0)a===0?f=e.dom:(Z(i,t,a),f=C(),M(i,f,o));else{if(a===0){i.removeChild(e.dom),U(n,r,i,s,o);return}rt(i,n,s,t,r,!0,o),r=n.children;if(g(r)){f=r[0].dom,l=0;for(var c=0,h=r.length;c<h;c++)l+=r[c].domLength||1}else f=r.dom,l=r.domLength}n.dom=f,n.domLength=l}function dt(e){if(!m(e)){var n=e.dom;if(n){var r=e.events;if(r){for(var i in r)K(n,i);var s=r.$destroyed;s&&D(s,"$destroyed",n,e)}n.virtualNode&&(n.virtualNode=t)}var o=e.children;o&&vt(o,G(o))}}function vt(e,t){if(t>1)for(var n=0,r=e.length;n<r;n++)dt(e[n]);else t!==0&&dt(T(e,t))}function mt(e,n){var r;for(r in e)n[r]=e[r];for(r in n)e[r]===t&&(n[r]=t)}function gt(e){e&&e!=r.body&&e!=r.activeElement&&e.focus()}var n={},r=e.document,i=e.navigator,s=function(){},o=e.console||{warn:s,error:s},u=i.userAgent,a=u.indexOf("WebKit")!==-1,f=u.indexOf("Firefox")!==-1,l=u.indexOf("Trident")!==-1,c=r.createElement("div"),h="textContent"in r,p="addEventListener"in r,d="createRange"in r,v="setProperty"in c.style,k=r.createElement("p"),L,A;k.insertAdjacentHTML&&(k.appendChild(r.createTextNode("a")),k.insertAdjacentHTML("beforeend","b"),L=k.childNodes.length===1,k=r.createElement("p"),k.appendChild(C()),k.insertAdjacentHTML("beforeend","<b>"),A=k.firstChild.nodeType!==3);var H="",Y=d?r.createRange():null,it=!1,yt=n.vdom={create:function(e){return e=b(e),_(e),e},append:function(e,t){return t=b(t),_(t,e),t},update:function(e,t){var n=r.activeElement;return t=b(t,e),ht(e,t,e.dom.parentNode),mt(t,e),gt(n),e},updateChildren:function(e,t){var n=r.activeElement,i=e.children;i!==t&&rt(e.dom,e,e.ns,i,t,!e.tag),gt(n)},remove:function(e){var t=e.dom.parentNode;tt(t,e)}};return n}),e("src/vdom",["citojs"],function(e){"use strict";function h(e,t,n){var r="",i={};return e=e.replace(s,function(e,s,o){if(s=="$"){var u="__"+o;return i[o]||(i[o]=!0,r+="var "+u+' = "";\n',n&&n.indexOf(o)!==-1?r+="try { "+u+" = "+l(t[o])+" } catch (err) { "+u+" = void 0}":r+=c(u,t[o],!0,u+" = void 0"),r+="\n"),u}return s[0]==="\\"?e.substr(1):t[o]}),r+e}function v(e,t){var n=t.prepare?t.prepare(e,e.attrs):e.attrs;return{tag:t.tag!==!1&&!t.scope&&e.name,scope:t.scope,computed:t.computed||t.scope,data:n,toCode:function(){var r=[],i=[].concat(t.toCode?t.toCode.call(this,n,e):["",""]);return t.required&&t.required.forEach(function(t){n[t]===void 0&&(!n.attrs||n.attrs[t]===void 0)&&e.exception('missing required attribute "'+t+'"')}),t.scope?(r.push(h(i[0],n,t.expressions)),this.outro=i[1]):(i=i[0],t.tryCatch&&r.push("try {"),typeof i=="string"?(r.push(h(i,n,t.expressions)),t.tryCatch&&r.push("}")):("raw text".indexOf(i.output)>-1?r.push('@@ = {tag: "<", children: '+i.expr+"};"):r.push("@@ = "+i.expr+";"),t.tryCatch&&r.push('} catch (err) {@@ = ""}'))),r.join("\n")}}}function m(t,n){var r,i,s;try{r="var __vroot__ = {children:[]}, __bkey";while(n--)r+=", __v"+n;r+=t.toString();do i=r,r=r.replace(/(__[a-z0-9]+(?:__)?\.children\.push\()(.*?)\)\n(\1)/g,"$1$2, ");while(r!==i);r+=[";if (_this !== void 0) {","  for (var evt, name, __events__ = _this.__events__, i = 0, n = __events__.length; i < n; i += 2) {","    name = __events__[i];","    evt = __vroot__.events[name];","    if (evt === void 0) evt = __vroot__.events[name] = [];",'  else if (typeof evt[0] !== "function") evt = __vroot__.events[name] = [evt];',"    evt.push(__events__[i+1]);","  }","}"].join("\n"),s=(new Function("__vdom",'"use strict";\nreturn function __vtpl(attrs, _this, Block, __vmatches, __vkey, mountQueue, __attr__, __val__) {\n'+r+"\nreturn __vroot__};"))(e.vdom)}catch(o){s=g([o.toString(),r])}return s}function g(e){return function(){return{tag:"div",attrs:{style:"white-space: pre; padding: 5px; margin: 5px; background: red; color: #fff; font-size: 14px; text-shadow: 1px 1px 0 #000"},children:e}}}var t=typeof document!="undefined"?document.createElement("div"):{},n=JSON.stringify,r=/^\{[^\}]+\}$/,i=/{.*?}/,s=/(\\?[$&])([a-z_]+)/g,o=/{|}/,u=/;+$/,a=function(e){delete e.parent,delete e.computedAttrs,delete e.computedChildren},f={},l=function(e){try{e=e.replace(u,"").trim(),f[e]===void 0&&(f[e]=!0,(new Function("attrs, name","return "+e))())}catch(t){if(!(t instanceof ReferenceError||t instanceof TypeError))throw"«"+e+"» - "+t.message}return e},c=function(e,t,s,u){var a=s?"":e+' = "";\n';return r.test(t)?a="try {"+e+" = "+l(t.slice(1,-1))+"}\ncatch (err) {"+(u||"")+"}":i.test(t)?a+=t.split(o).map(function(t,r){return r%2?t="try {"+e+" += "+l(t)+"}\ncatch (err) {"+(u||"")+"}":t!==""&&(t=e+" += "+n(t)+";"),t}).join("\n"):a+=e+" = "+(t?n(t):t)+";\n",a},p=function(e){if(typeof e=="string")return n(e);var t=e.key;t&&t.charAt(0)!=='"'&&t!=="__vkey"&&(t='"'+t+'"');var r="{"+("tag:"+n(e.tag))+(t?",key:"+t:"")+(e.attrs?",attrs:"+n(e.attrs):"")+(e.events?",events:{"+Object.keys(e.events).map(function(t){return n(t)+":"+e.events[t]})+"}":"");return e.children&&(r+=", children: ["+e.children.map(function(e){return e==null?n(""):e.tag?p(e,!0):p(e)}).join(", ")+"]"),r+"}"},d=e.vdom.tags={$set:function(e){Object.keys(e).forEach(function(t){d[t]=e[t]})}};e.vdom.from=function(r){var s=0,o=0,u=0,f=function(e,r){var l={tag:e.name},h=e.name,m=h.split(":"),g=d[h]||d[m[0]+":*"]||d["*:"+m[1]];return u=e,Object.keys(e.attrs).forEach(function(t){var n=e.attrs[t],r=t.split(":"),i=d["@"+t]||d["@"+r[0]+":*"];i&&i(r.pop(),n,e.attrs,e,l)!==!0&&delete e.attrs[t]}),h==="#text"?(t.innerHTML=e.value,t.textContent||t.innerText||""):h==="#comment"?"":(g&&(g.check&&g.check(e),l=v(e,g)),l.parent=r,l.computedAttrs=[],l.computedChildren=[],e.children.length&&(l.children=[],e.children.forEach(function(e){var t=f(e,l);t.computed||l.computed?(l.computed=!0,l.computedChildren.push(t)):(a(t),l.children.push(t))})),Object.keys(e.attrs).forEach(function(t){var n=e.attrs[t];t.substr(0,3)==="on-"?(l.events||(l.events={}),l.events[t.substr(3)]="function (evt){"+n+";evt.preventDefault && evt.preventDefault();}"):(l.attrs||(l.attrs={}),i.test(n)?(l.computed=!0,l.computedAttrs.push({name:t,code:c("__val__",n,!0)})):t==="key"?l[t]=n:n!=null&&(l.attrs[t]=n))}),l.toString=function(){var t=[];t.push("/* <"+e.name+"/> */");if(l.scope)l.varName=r?r.varName:"__vroot__";else if(l.computed||!r)l.varName=r?"__v"+s:"__vroot__",l.tid=s++;return l.tag&&t.push((l.varName?l.varName+" = ":"")+p(l)),l.toCode&&t.push(l.toCode()),l.scope||l.computedAttrs.forEach(function(e){t.push('__val__ = "";'),t.push(e.code),e.name==="key"?t.push(l.varName+".key = __val__;"):t.push("if (__val__ != null)",l.varName+".attrs["+n(e.name)+"] = __val__;")}),l.computedChildren.forEach(function(e){e.computed?(t.push(e.toString()),e.scope||t.push(l.varName+".children.push("+e.varName+");")):(a(e),t.push(l.varName+".children.push("+p(e,!0)+");"))}),l.outro&&t.push(l.outro),l.tid!==void 0&&(o=Math.max(s,o),s--),t.join("\n").replace(/@@/g,l.varName)},l)};try{return m(f(r).toString(),o)}catch(l){var h=[u.file+" at line "+u.line,l.toString(),u.empty().toString()].join("\n");return console.error(h),g(h)}};var y={};return e.vdom.animate=function(t,n,r,i){y[t]&&y[t].cancel();if(i)r&&r.children.forEach(function(e){e&&e instanceof Object&&(!e.attrs&&(e.attrs={"class":""}),e.attrs["class"]+=" fn-enter")});else if(n&&n.children){var s=Number.POSITIVE_INFINITY,o=function(){y[t].cancel(),n.children&&(n.dom=null,n.children=n.children.filter(function(e){var t=e.dom;if(t&&t.parentNode)return n.dom=n.dom||t,!0}),n.domLength=n.children.length,n.domLength&&e.vdom.update(n,{}))};return y[t]={elems:[],cancel:function(){clearTimeout(this.pid),this.elems.forEach(function(e){e.removeEventListener("animationend",o)}),this.elems=null,y[t]=null,o=null}},n.children.forEach(function(e,n,r){var i=e.dom;i&&i.classList&&(e.attrs["class"]=e.attrs["class"].replace("fn-enter","fn-leave"),i.classList.remove("fn-enter"),i.classList.add("fn-leave"),n=window.getComputedStyle(i),n=n.animationDuration||n.webkitAnimationDuration,r=parseFloat(n),r>0&&(s=Math.min(r*(/ms/.test(n)?1:1e3),s)),i.addEventListener("animationend",o),y[t].elems.push(i))}),y[t].pid=setTimeout(o,s),!0}},e.vdom.mods={},e.vdom.checkExpr=l,e.vdom.interpolateValue=c,e.vdom}),function(){"use strict";function a(e,n){var r=e.__emList;return n=n.toLowerCase().replace(t,""),r===void 0?(r=e.__emList={},r[n]=[]):r[n]===void 0&&(r[n]=[]),r[n]}function l(e){if(e instanceof l)return e;if(e.type){for(var n in e)s.call(e,n)&&(this[n]=e[n]);e=e.type}this.type=e.toLowerCase().replace(t,"")}var t=/-/g,n=/\s+/,r=/-(.)/g,i=function(e,t){return t.toUpperCase()},s={}.hasOwnProperty,o=[],u=function(){return!0},f=function(){};f.fn=f.prototype={constructor:f,on:function(e,t){e=e.split(n);var r=e.length,i;while(r--)i=a(this,e[r]),i.push(t);return this},off:function(e,t){if(e===void 0)this.__emList=e;else{e=e.split(n);var r=e.length;while(r--){var i=a(this,e[r]),s=i.length,o=-1;if(arguments.length===1)i.splice(0,1e5);else{if(i.indexOf)o=i.indexOf(t);else while(s--)if(i[s]===t){o=s;break}o!==-1&&i.splice(o,1)}}}return this},one:function(e,t){var n=function(){return this.off(e,n),t.apply(this,arguments)};return this.on(e,n)},emit:function(e,t){var n=a(this,e),s=n.length,u,f,l,c,h;e="on"+e.charAt(0).toUpperCase()+e.substr(1),e.indexOf("-")>-1&&(e=e.replace(r,i)),typeof this[e]=="function"&&(c=this[e].apply(this,[].concat(t)));if(s>0){t=t===void 0?o:[].concat(t),h=t.length;while(s--)u=n[s],f=this,u!==void 0&&(u.handleEvent!==void 0&&(f=u,u=u.handleEvent),h===0?l=u.call(f):h===1?l=u.call(f,t[0]):h===2?l=u.call(f,t[0],t[1]):l=u.apply(f,t),l!==void 0&&(c=l))}return c},trigger:function(e,t){var n=new l(e);return n.target=n.target||this,n.result=this.emit(e.type||e,[n].concat(t)),this}},l.fn=l.prototype={constructor:l,isDefaultPrevented:function(){return!1},preventDefault:function(){this.isDefaultPrevented=u}},f.apply=function(e){return e.on=f.fn.on,e.off=f.fn.off,e.one=f.fn.one,e.emit=f.fn.emit,e.trigger=f.fn.trigger,e},f.version="0.2.3",f.Event=l,f.getListeners=a,typeof e=="function"&&(e.amd||e.ajs)?e("Emitter",[],function(){return f}):typeof module!="undefined"&&module.exports?module.exports=f:window.Emitter=f}(),e("src/mediator",["Emitter"],function(e){"use strict";var t={},n={},r=function(){var e=this,t=e.components;e._components=Object.keys(t).map(function(r){var i=t[r],s=i.attrs,o=i.handleEvent||e.handleEvent;return typeof o=="string"&&(o=e[o]),i.name=r,i.handleEvent=function(t){o.call(e,t)!==!1&&e.updateAll()},s&&(i.attrs=Function("return {"+Object.keys(s).map(function(e){return'"'+e+'": '+s[e]}).join(", ")+"}"),n[e.name+":"+i["class"].prototype.name]=Function("attrs",Object.keys(s).map(function(e){return'attrs["'+e+'"] = '+s[e]}).join(";\n"))),i}),e.components={},e.defaults()};return r.prototype={constructor:r,defaults:function(){},register:function(e){var t=this;this._components.some(function(n){if(e instanceof n["class"])return n.instance=t.components[n.name]=e,n.events&&n.events.length&&n.events.forEach(function(t){e.on(t,n.handleEvent)}),e.on("$destroyed",function(){n.instance=t.components[n.name]=null}),!0})},updateAll:function(){var e=this;e._components.forEach(function(t){var n=t.instance;n&&t.attrs&&(n.set(t.attrs.call(e),null,!0),n.render())}),this.emit("update",e)}},r.create=function(e,n){var i=function(){r.apply(this,arguments)};i.prototype=Object.create(r.prototype,{constructor:{value:i}}),i.prototype.name=e;for(var s in n)n.hasOwnProperty(s)&&(i.prototype[s]=n[s]);return t[e]=new i,t[e]},r.use=function(e,n){t[e].register(n)},r.get=function(e){return t[e]},r.setTagAttrs=function(e,r,i){var s=n[e+":"+r];s&&s.call(t[e],i)},e.apply(r.prototype),r}),e("src/block",["./vdom","./mediator","Emitter"],function(e,t,n){"use strict";function y(t,n){var r={};r["b:"+t]={scope:!0,prepare:function(e,t){var n={attrs:{},events:[]};t.key||i.warn("<"+e.name+'/>: Missing "key" attribute \n'+e.file+" at line "+e.line);if(e.length&&e.first.name.split(":").pop()!=="match"){var r=e.create("fn:match",{name:"default"});e.children.forEach(function(e){r.append(e)}),e.empty().append(r)}return Object.keys(t).forEach(function(e){e.substr(0,3)==="on-"?n.events.push(e.substr(3),t[e]):n.attrs[e]=t[e]}),n},toCode:function(e,n){var r=e.attrs,i=r.key||n.uid,s="__vmatches"+n.uid;return delete r.key,r=Object.keys(r).map(function(e){return h('__attrs["'+e+'"]',r[e])}).join("\n"),["var "+s+" = {};"+"var __attrs = {};\n"+r+h("__bkey",i),"_this.constructor.render("+["_this",this.varName+".children",'__vkey + ":'+n.uid+':" + __bkey',a(t),"__attrs","["+e.events.map(function(e,t){return t%2?"function (evt) { "+e+"; evt.preventDefault && evt.preventDefault(); }":a(e)})+"]",s,"mountQueue"].join(", ")+");"]}},e.tags.$set(r),u[t]&&(u[t].getInstances().forEach(function(e){e.destroy()}),u.splice(u.indexOf(u[t]),1)),u[t]=n,u.push(n)}function b(e){var t=this;this.key=++o,this.__events__=[],this.__matches__={},this.refs={},this.components={},this.compiledTemplate===void 0&&this.constructor.setTemplate(this.template),this.debouncedRender=function(){t._debouncedRenderId===void 0&&(t._debouncedRenderId=setTimeout(function(){t._debouncedRenderId=void 0,t.render()},0))},e===void 0?this.attrs=p(this.defaults):(this.attrs=e,this.key=e.key||this.key,e.model&&e.model.on&&e.model.on(l,this.debouncedRender),e.models&&e.models.on&&e.models.on(c,this.debouncedRender)),this.domListeners=[],f[this.key]=this}var r=typeof window!="undefined"?window:{},i=r.console||{},s=r.performance||{};!s.now&&(s.now=function(){return+(new Date)}),!i.log&&(i.log=function(){}),!i.warn&&(i.warn=function(){});var o=0,u=[],a=JSON.stringify,f={},l="change",c="add remove sort reset",h=e.interpolateValue,p=function(e){return JSON.parse(a(e))},d=function(){return this.defaultPrevented},v=function(){this.returnValue=!1,this.defaultPrevented=!0},m=function(){this.cancelBubble=!0},g=function(){this.stopPropagation()};return r.Event&&Event.prototype&&(!Event.prototype.preventDefault&&(Event.prototype.preventDefault=v),!Event.prototype.isDefaultPrevented&&(Event.prototype.isDefaultPrevented=d),!Event.prototype.stopImmediatePropagation&&(Event.prototype.stopImmediatePropagation=g)),b.prototype={template:void 0,compiledTemplate:void 0,name:"block",blocks:{},virtual:!1,defaults:{},attrChanged:{},events:{},destroyed:!1,broadcast:function(e,t,r){var i=r?r.target:this.el,s=new n.Event(e),o,u,a,f=!1;s.target=i,s.details=r&&(r.details||t||this),s.originalEvent=r;do{o=i.virtualNode,u=o&&o.events&&o.events[e];if(u){u=[].concat(u);for(var l=0,c=u.length;l<c;l++)a=u[l](s),a!==!0&&s.preventDefault(),a===!1&&(f=!0,s.stopPropagation());if(f)break}}while((i=i.parentNode)!=null);r&&s.isDefaultPrevented()&&r.preventDefault()},findDomListener:function(e,t,n){var r=this.domListeners,i=r.length,s;while(i--){s=r[i];if(s.el===e&&s.name===t&&s.fn===n)return s}return null},on:function(e,t){this.__events__.push(e,t)},off:function(){},$on:function(e,t,n){var i,s=this;typeof n=="string"&&(i=n,n=s["___"+i]||(s["___"+i]=function(){return s[i].apply(s,arguments)})),this.findDomListener(e,t,n)||(e.addEventListener?e.addEventListener(t,n,!1):(n.handle=n.handle||function(t){return t=t||r.event,t.currentTarget=e,t.preventDefault=v,t.stopPropagation=m,t.defaultPrevented=t.returnValue===!1,t.target=event.srcElement,t.isDefaultPrevented=d,t.stopImmediatePropagation=g,n.call(this,t)},e.attachEvent("on"+t,n.handle)),s.domListeners.push({el:e,name:t,fn:n}))},$off:function(e,t,n){typeof n=="string"&&(n=this["___"+n]);var r=this.findDomListener(e,t,n);r&&(e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent("on"+t,n.handle),this.domListeners.splice(this.domListeners.indexOf(r),1))},is:function(e){return!!this.attrs[e]},get:function(e){return this.attrs[e]},set:function(e,t,n){var r=e,i=[],s={};if(typeof e=="string")this.attrs[r]!==t&&(i.push(r),s[r]=this.attrs[r],this.attrs[r]=t);else for(r in e)t=e[r],this.attrs[r]!==t&&(i.push(r),s[r]=this.attrs[r],this.attrs[r]=t);i.length&&this.el&&(!n&&this.render(),i.forEach(function(e){this.attrChanged[e]&&this.attrChanged[e].call(this,this.attrs[e],s[e])},this))},invert:function(e){var t=this.attrs[e];this.set(e,t===0?1:t===1?0:!t)},$handleEvent:function(e){var t=e.type;if(t==="$created"||t==="$changed"||t==="$subtreeModified")this.virtualNode=e.virtualNode,this.el=this.virtualNode.dom;else if(t==="$mount"){this.didMount!==void 0&&this.didMount();var n=this.attrChangedKeys,r=n.length;while(r--){var i=n[r],s=this.attrChanged[i];s.call(this,this.attrs[i],this.defaults[i])}}else t==="$destroyed"&&(this.didUnmount!==void 0&&this.didUnmount(),this.destroy())},createFragment:function(e){return this._debouncedRenderId!==void 0&&(clearTimeout(this._debouncedRenderId),this._debouncedRenderId=void 0),this.compiledTemplate(this.attrs,this,b,this.__matches__,this.key||"root",e)},render:function(t){if(this.destroyed)return!0;var n=this.performanceTrace,r=s.now();n==="profile"&&i.profile();var o,u=[],a=this.createFragment(u),f=s.now(),l=this.virtualNode!==void 0,c;l?this.virtualNode=e.update(this.virtualNode,a):t&&t.target&&(u.push(this),this.virtualNode=e.append(t.target,a)),o=u.length;while(o--)u[o].$handleEvent({type:"$mount"});return n&&(n==="profile"&&i.profileEnd(),c=s.now(),i.info("[feast:perf:"+this.name+"]","fragment: "+(f-r).toFixed(3)+"ms"+", vdom."+(l?"update":"append")+": "+(c-f).toFixed(3)+"ms"+", total: "+(c-r).toFixed(3)+"ms")),this},renderTo:function(e){return this.render({target:e})},remove:function(){e.remove(this.virtualNode)},_removeRef:function(e){for(var t in this.refs)if(this.refs[t]===e){delete this.refs[t];break}},destroy:function(){var e=this.attrs;if(!this.destroyed){this.destroyed=!0,e.model&&e.model.off&&e.model.off(l,this.debouncedRender),e.models&&e.models.off&&e.models.off(c,this.debouncedRender);var t=this.domListeners,n=t.length,r;while(n--)r=t[n],r.el.removeEventListener?r.el.removeEventListener(r.name,r.fn,!1):r.el.detachEvent("on"+r.name,r.fn);this.el=null,this.virtualNode=null,this.attrs=null,this.domListeners=null,this.refs={},delete f[this.key]}else i.warn("[feast:destroyed]",this.name,this.key)}},b.render=function(e,n,r,i,s,o,a,l){var c=f[r],h=this.prototype.blocks[i]||u[i],p,d=s.__mediators;return d&&(s.__mediators=void 0,d.forEach(function(e){t.setTagAttrs(e,i,s)})),c===void 0?(s.key=r,f[r]=c=new h(s,o),c.__events__=o,d&&d.forEach(function(e){t.use(e,c)}),l!==void 0&&l.push(c)):c.set(s,null,!0),c.__matches__=a,s.id&&(e.components[s.id]=c),p=c.createFragment(l),n.push(document.documentMode<9?{tag:"script",type:"b:"+i}:{tag:"!",children:"b:"+i},p),c},b.extend=function(e){var t=this,n=t.prototype;typeof e=="function"&&(e=e(n,t));var r=e.hasOwnProperty("constructor")?e.constructor:function(){t.apply(this,arguments)};if(!e.name)throw new Error('Missing property "name" into feast.Block.extend({ })');y(e.name,r);var i=r.prototype=Object.create(n);return i.constructor=r,i.compiledTemplate=void 0,Object.keys(e).forEach(function(t){if(t!=="constructor"){var n=i[t];(t==="events"||t==="attrChanged")&&Object.keys(n).forEach(function(r){e[t][r]=e[t][r]||n[r]}),i[t]=e[t]}}),Object.keys(n.blocks).forEach(function(e){i.blocks[e]||(i.blocks[e]=n.blocks[e])}),i.attrChangedKeys=Object.keys(i.attrChanged),Object.keys(t).forEach(function(e){r[e]=t[e]}),r},b.setTemplate=function(t){var n=this.prototype,r=n.events,i=t.clone(),s=i.attrs;i.parent=t.parent,n.virtual||(s["bem:block"]=n.name),s.key="__vkey",r.$created="$handleEvent",r.$changed="$handleEvent",r.$subtreeModified="$handleEvent",r.$destroyed="$handleEvent",Object.keys(r).forEach(function(e){s["on-"+e]="if (_this."+r[e]+"(evt) === true)return true;"}),this.block=n.name,n.template=t,n.compiledTemplate=e.from(i),n.virtual||this.getInstances().forEach(function(e){e.render()})},b.getInstances=function(){var e=[];return Object.keys(f).forEach(function(t){var n=f[t];n.constructor===this&&e.push(n)},this),e},b.getMediator=function(e){return t.get(e)},n.apply(b),b.all=u,b.instances=f,b.vdom=e,b}),e("src/tags",["./block","./vdom"],function(e,t){"use strict";var n=0,r=JSON.stringify,i=t.checkExpr,s=t.interpolateValue;t.tags.$set({"@ref":function(e,t,n){var r=s("__attr__",t);return n["on-$created"]=r+";_this.refs[__attr__] = evt.virtualNode.dom;",n["on-$changed"]=r+";_this._removeRef(evt.virtualNode.dom);_this.refs[__attr__] = evt.virtualNode.dom;",n["on-$destroyed"]="_this._removeRef(evt.target);",!0},"@remit:*":function(e,t,n){var r=n["event:details"];delete n["event:details"],n["on-"+e]='return _this.broadcast("'+t+'", '+r+", evt);"},"@use:mediator":function(e,t,n){n.__mediators=t.trim().split(/\s+/)},"@bem:block":function(e,t,n,r,i){r.bemBlock=t,i.bem=r.bem=t,n["class"]=(t+" "+(n["class"]||"")).trim()},"@bem:elem":function(e,t,i,s,o){while((s=s.parent||s.previousParent)!=null){var u=s.bemBlock||/^b:/.test(s.name)&&s.name.split(":")[1];if(u){s.bem=o.bem=u+"__"+t,i.key!=="__vkey"&&(i.key=r(++n+":"+(i.key||o.bem))),i["class"]=(o.bem+" "+(i["class"]||"")).trim();break}}},"@bem:mod":function(e,t,n,r){r.newChild("bem:mod",{name:t},r.first)},"bem:mod":{scope:!0,required:["name"],expressions:["test"],prepare:function(e,t){return{name:t.name,value:t.value,test:t.test}},toCode:function(e){var t=this.parent.bem,n=[s("__attr__",e.name),s("__val__",e.value),"if (__attr__ != null) {",'  __val__ = __attr__ + (__val__ != null ? "_" + __val__ : "");','  @@.attrs["class"] += '+r(" "+t+"_")+" + __val__;","}"];return e.name==="disabled"&&n.push("@@.attrs["+r(e.name)+"] = true;"),e.test&&(n.unshift("if ($test) {"),n.push("}")),[n.join("\n"),""]}},"b:block":{scope:!0,prepare:function(e,t){return{is:t.is.slice(1,-1),key:t.key&&t.key.slice(1,-1),attrs:t.attrs&&t.attrs.slice(1,-1)}},toCode:function(e,t){var n="("+e.is+") + "+e.key,r="__vmatches"+t.uid;return["var "+r+" = {};",'Block.render(_this, @@.children,  __vkey + ":" + '+n+", "+e.is+", "+e.attrs+", [], "+r+", mountQueue);"]}},"*:debugger":{scope:!0,toCode:function(){return["debugger;"]}},"*:virtual-block":{scope:!0,prepare:function(t,n){var r=n.name,i=t.first.remove();delete n.name,i.parent=t.parent,n.define||t.newChild("b:"+r,n),e.all[r]?e.all[r].setTemplate(i):e.extend({name:r,virtual:!0,template:i})},toCode:function(){return["",""]}},"*:value":{tag:!1,computed:!0,tryCatch:!0,prepare:function(e,t){return{mod:t.mod,expr:i(e.first.remove().value),output:t.output}},toCode:function(e){var t="(__val__ = "+e.expr+", "+(e.mod?"__vdom.mods["+r(e.mod)+"]":"")+'(__val__ == null ? "" : __val__) + "")';return{expr:t,output:e.output}}},"*:for":{scope:!0,required:["data"],expressions:["data"],prepare:function(e,t){return{as:t.value||t.as||"$value",key:t.index||t.key||"$index",data:t.iterate||t.data}},toCode:function(){return["$data && $data.forEach && $data.forEach(function (&as, &key) {","});"]}},"*:attr":{scope:!0,required:["name"],expressions:["test"],prepare:function(e,t){return{name:t.name,value:t.value,test:t.test,mode:t.mode,separator:t.separator}},toCode:function(e,t){var n=t.parent.scope?!1:t.parent.hasAttrs||Object.keys(t.parent.attrs).length>0;return t.parent.hasAttrs=!0,[(n?"":"if (@@.attrs === void 0) @@.attrs = {};\n")+(e.test?"if ($test) {":"")+(e.mode==="concat"?"if (@@.attrs[$name] !== void 0) $value = @@.attrs[$name] + $separator + $value;":"")+"@@.attrs[$name] = $value;",e.test?"}":""]}},"*:add-class":{scope:!0,required:["name"],prepare:function(e,t){return e.newChild("fn:attr",{name:"class",value:t.name,test:t.test,mode:"concat",separator:" "}),e.scope=!0,t}},"*:if":{scope:!0,required:["test"],expressions:["test"],prepare:function(e,t){return t},toCode:function(e,t){return e.animated?["@@.children.push(function (old) {	var @@ = {children: []};	var __test;\n	try { __test = &test } catch (e) {}\n	if (__test) {","		__vdom.animate("+t.uid+", old, @@, true);"+"	} else if (__vdom.animate("+t.uid+", old, @@, false)) {"+"		return old;"+"	}"+"	return @@;"+"});"]:["if ($test) {","}"]}},"*:match":{scope:!0,required:["name"],prepare:function(e,t){return{name:t.name,args:t.args?(t.args||"").split(","):"attrs"}},toCode:function(e,t){var n=[this.varName].concat(e.args),i=!/^b:/.test(t.parent.name),s="__vmatches"+(i?"":t.parent.uid)+"["+r(e.name)+"]";return[s+" = "+(i?s+" || ":"")+" function ("+n.join(", ")+") {","}"]}},"*:apply-match":{scope:!0,required:["name"],prepare:function(e,t){return{name:t.name,args:t.args?(t.args||"").split(","):"attrs",children:e.children.length>0}},toCode:function(e){if(e.children)return[";(function (__vmatch, "+this.varName+") {\n"+"  __vmatches["+r(e.name)+"]("+["__vmatch"].concat(e.args).join(",")+");\n"+"  if (__vmatch.children.length > 0) {\n","  }\n})({children:[]}, "+this.varName+");\n"];var t="__vmatches["+r(e.name)+"]";return["",t+" && "+t+"("+[this.varName].concat(e.args).join(", ")+");"]}},"*:match-result":{scope:!0,prepare:function(){return null},toCode:function(){var e=this.varName+".children";return[e+".push.apply("+e+", __vmatch.children);\n",""]}},"*:choose":{scope:!0,prepare:function(e){e.when=0},toCode:function(e,t){return["",(new Array(t.when+1)).join("}")]}},"*:when":{scope:!0,required:["test"],expressions:["test"],prepare:function(e,t){return e.parent.when++,t},toCode:function(){return["if ($test) {","} else {"]}},"*:otherwise":{scope:!0,check:function(e){e!==e.parent.last&&e.exception("this tag must be the last into <"+e.parent.name+"/>")},toCode:function(e,t){return["",""]}},"*:var":{scope:!0,required:["name"],prepare:function(e,t){return t},toCode:function(){return["var &name = $value;",""]}},"mediator:*":{scope:!0,prepare:function(n,r){r.key=r.name=n.name,r.mediator='{Block.getMediator("'+r.name.split(":").pop()+'")}',n.append(n.create("fn:var",{name:r.as,value:r.mediator}),n.first),n.innerWrap("div"),t.tags["*:virtual-block"].prepare.call(this,n,r);var i=e.all[r.key].prototype;i.handleEvent=function(){this.render()},i.didMount=function(){this.attrs.mediator.on("update",this)},i.didUnmount=function(){this.attrs.mediator.off("update",this)}},toCode:function(){return["",""]}},"*:closure":{scope:!0,prepare:function(e,t){return t},toCode:function(e,t){var n="__v"+t.uid,r=Object.keys(e),i=n+r.join(", "+n);return["var "+i+";\n"+r.map(function(t){return"try {"+n+t+" = "+e[t]+"} catch (err) {}"}).join(", ")+";\n"+"(function ("+r+") {","})("+i+");"]}}})}),typeof e=="function"&&e.amd?e("feast",["module","./src/xmlparser","./src/vdom","./src/block","./src/mediator","./src/tags"],function(e,t,n,r,i){"use strict";return{config:e.config(),vdom:n,tags:n.tags,mods:n.mods,Block:r,Mediator:i,ajax:function(e,t){var n;try{n=new XMLHttpRequest}catch(r){n=new ActiveXObject("Msxml2.XMLHTTP");try{n=new ActiveXObject("Microsoft.XMLHTTP")}catch(r){n=new ActiveXObject("Msxml2.XMLHTTP.4.0")}}n.open("GET",e,!0),n.onreadystatechange=function(){if(n.readyState===4){var r=n.status|0;n.onreadystatechange=null,t(r>=200&&r<=204?null:r,n.responseText,n)}},n.send(null)},resource:function(e,t){var n=this.ajax;return t=t||{},{url:function(t){var n=e,r=[];t=t||{},n=n.replace(/:(\w+)([\/&]?)/g,function(e,n,r){return t[n]?t[n]+(r||""):""});for(var i in t)t.hasOwnProperty(i)&&r.push(encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return n+(r.length?(n.indexOf("?")!==-1?"&":"?")+r.join("&"):"")},find:function(e){var r=this.url(e);return new Promise(function(e,i){n(r,function(n,r,s){if(n)i(s);else try{r=JSON.parse(r),t.body&&(r=r[t.body]),e(r)}catch(n){i(n)}})})},findOne:function(e){var n={};return n[t.id||"id"]=e,this.find(n).then(function(e){return(Array.isArray(e)?e[0]:e)||Promise.reject(new Error(404))})}}},parse:function s(e,n,r){var i;try{i=t(e,{file:n},r).first}catch(o){i=s('<div key="tpl-compile-error" style="white-space: pre; padding: 5px; margin: 5px; background: red; color: #fff; font-size: 11px; text-shadow: 1px 1px 1px #000">'+o.toString().replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</div>",n)}return i}}}):module.exports=require("./app/api")})(typeof define=="function"&&define.amd?define:function(){var e={module:{config:function(){return{}}}},t=function(t,n,r){var i=n.length,s;while(i--)s=t.split("/").slice(0,-1).join("/"),n[i]=e[n[i].replace("./",s?s+"/":"")];t==="feast"?window.feast=r.apply(null,n):e[t]=r.apply(null,n)};return t.amd=!0,t}());